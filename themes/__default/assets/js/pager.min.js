"use strict";window.pager={debug:!1,page_title:null,song_title:null,loading:!1,log:function(e){pager.debug&&console.log("pager."+e)},bind:function(){pager.log("bind"),pager.bind_links()},bind_links:function(){pager.log("bind_links"),$("body").find("a").off("click"),$("body").find("a").on("click",function(e){$(this).attr("href")&&$(this).attr("href").substr(0,$_home.length)==$_home&&(muse.que_open&&muse.close_que(),closeModal(),pager.load_start(),e.preventDefault(),pager.page_load($(this).attr("href")))})},page_reload:function(e){e=!0===e,pager.log("reload"),pager.page_load(window.location.href,!1,e)},page_load:function(e,a,o){a=!1!==a,o=!1!==o,pager.trigger_off(),$(document).trigger("pageUnloaded"),$(document).trigger("pageUnloaded_m"),pager.load_start(),pager.log("page_load url="+e),be_cli({url:e,dataType:"html",callBack:pager.page_loaded,callBack_param:[e,a,o],background:!1,goodHeader:200})},page_loaded:function(e,a,o){if(!a.includes('id="scroller"'))return pager.log("no #scroller found!"),a.includes("page_no_access")?(pager.load_finish(),void createNoAccessModal()):void(window.location=o[0]);var t=$(a),r=t.filter("#main").html(),l=t.filter("title").text();if(a.match(/<body class="(.*?)">/)){var i=a.match(/<body class="(.*?)">/)[1];if(i.match(/theme_admin/))return pager.log("direct request"),void(window.location=o[0]);var n=[];jQuery.grep($("body").attr("class").split(" "),function(e){"page_"!=e.substr(0,5)&&"pt_"!=e.substr(0,3)&&n.push(e)}),jQuery.grep(i.split(" "),function(e){"hard_loading"!=e&&-1==jQuery.inArray(e,n)&&n.push(e)}),$("body").attr("class",n.join(" ")),pager.set_type()}if(pager.log("page_loaded title="+l),!e||!r)return $("body").addClass("failed"),pager.log("failed"),void setTimeout(function(){window.location.reload()},2e3);o[1]&&window.history.pushState(a,l,o[0]),$(document).off("pageUnloaded"),$(document).off("pageInlined"),$(document).find("#scroller").html(r.trim().substr(19).substr(0,r.trim().length-25)),pager.page_load_images(o[2]),pager.page_title=l,pager.set_title(),pager.set_menu(),pager.bind(),be_cli_forms_hook()},page_load_images:function(e){$("#scroller").waitForImages(function(){pager.trigger_on(),$(document).trigger("pageInlined"),$(document).trigger("pageInlined_m"),!1!==e&&$("#scroller").animate({scrollTop:0},"slow"),pager.load_finish(),muse.update_dom_buttons(),muse.update_dom_waves()})},load_start:function(e){!0!==pager.loading&&(!0!==e&&$("body").addClass("loading"),$("body").addClass("active"),$("body").prepend("<div class='pager_wrapper'><div id='pager'></div><div id='pager_text'>"+$_texts.wait+"</div></div>"),$("body").hasClass("hard_loading")&&($(window).width()>540?window.loader.start():$("body").removeClass("hard_loading")),pager.loading=!0)},load_finish:function(){$("body").removeClass("loading").removeClass("active").removeClass("hard_loading"),window.loader.end(),$("body").find(".pager_wrapper").remove(),pager.loading=!1,$("body").find(".button_more.active").removeClass("active");var e=window.location.hash;e&&$(e).length&&$("#scroller").animate({scrollTop:$(e).offset().top+$("#scroller").scrollTop()-$(e).height()-50},700),$("#scroller")[0].scrollHeight>$("#scroller").outerHeight()?$("#scroller").addClass("scrolled").removeClass("nonscrolled"):$("#scroller").removeClass("scrolled").addClass("nonscrolled")},set_type:function(){$("body").attr("class").match(/page_(.*?) /gi)&&(pager.page_type=$("body").attr("class").match(/page_(.*?) /gi)[0].toString().trim().substr(5))},set_title:function(){pager.song_title?$(document).find("title").text(decode_htmlspecialchars(pager.song_title)):pager.page_title&&$(document).find("title").text(decode_htmlspecialchars(pager.page_title)),pager.log("set_title st="+pager.song_title+", pt="+pager.page_title)},set_menu:function(){pager.log("set_menu"),$(".menu_wrapper li.active").removeClass("active");for(var e=$(".menu_wrapper li.p"),a=0;a<e.length;a++)for(var o=e[a],t=$(o).find("a"),r=0;r<t.length;r++){var l=t[r];l.href==window.location.href&&($(o).addClass("active"),$(l).parent().attr("class")&&$(l).parent().attr("class").split(" ").includes("c")&&$(l).parent().addClass("active"))}},trigger_on:function(){if("track"==pager.page_type&&($("#waveform .pr img").css("width",$("#waveform .bg").width()+"px"),$("#waveform .pr img").css("height",$("#waveform .bg").height()+"px")),"user_logout"==pager.page_type&&(window.location=$_home),"user_upload"==pager.page_type){console.log($_home+"user_upload?action=user_upload_music&ID="+$(document).find("#uploader").attr("data-id"));var e={url:$_home+"user_upload?action=user_upload_music&ID="+$(document).find("#uploader").attr("data-id"),paramName:"$file",maxFilesize:$_config.upload_max_size,parallelUploads:$_config.upload_max_par_ups,acceptedFiles:".mp3",createImageThumbnails:!1,previewsContainer:"#uploading",timeout:1e3*$_out_time,init:__ini};$_config.chunk&&(e.chunking=!0,e.retryChunks=!0,e.chunkSize=1e6*$_config.chunk_size),$__dropzone=new Dropzone("#uploader",e)}},trigger_off:function(){if("track"==pager.page_type&&"undefined"!=typeof wavesurfer&&void 0!==wavesurfer&&null!==wavesurfer&&(wavesurfer.cancelAjax(),wavesurfer=null),"user_upload"==pager.page_type){if(null===$__dropzone)return;$__dropzone.removeAllFiles(!0)}}},window.loader={vivus:null,pointer:0,svgs:["/themes/__default/assets/icons/loading_svgs/l1.svg","/themes/__default/assets/icons/loading_svgs/l3.svg","/themes/__default/assets/icons/loading_svgs/l4.svg","/themes/__default/assets/icons/loading_svgs/l2.svg"],dom:"#pager",timer:null,start:function(){loader.vivus=new Vivus("pager",{duration:220,type:"delayed",file:$_home+loader.svgs[loader.pointer],onReady:function(e){loader.vivus.play(1)}},function(){"end"===loader.vivus.getStatus()?loader.timer=setTimeout(function(){loader.vivus.play(-1)},350):($("#pager").html(" "),loader.vivus.destroy(),loader.pointer=(loader.pointer+1)%loader.svgs.length,loader.start())})},end:function(){loader.vivus&&loader.vivus.destroy(),loader.timer&&(clearTimeout(loader.timer),loader.timer=null),$("body").removeClass("hard_loading")}},$(document).trigger("pageInlined_m"),window.addEventListener("resize",function(e){$(document).trigger("pageUnloaded"),$(document).trigger("pageInlined")});
